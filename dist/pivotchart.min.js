angular.module("pivotchart.controller",["pivotchart.service"]).controller("MainCtrl",["$scope","chartTypes","charts","input","$modal","$http","$timeout","$window",function(a,b,c,d,e,f,g,h){a.charts=c.get(),a.chartTypes=b.get(),a.width=525,a.height=376,a.maps={y:[],x:[],color:[]},a.$watch("maps",function(){for(;a.maps.x.length>a.chart.hAxis.bands.length;)a.chart.hAxis.bands.push(.1)},!0),a.tableInput=_.transpose([["","Category 1","Category 2"],["Sales",54,150],["Income",110,499],["Expense",879,79]]),a.tableInput=[["Category","Geography","Sales","Profit"],["Category 1","Europe",154,23],["Category 2","Europe",150,30],["Category 1","America",110,4],["Category 2","America",499,99],["Category 1","Asia",879,200],["Category 2","Asia",79,10]],a.tableConfig={minSpareCols:1,minSpareRows:1,stretchH:"all",minRows:5,minCols:4,enterBeginsEditing:!1},a.$watch("tableInput",function(){d.load(a.tableInput)},!0),d.load(a.tableInput),a.inputArg=d.data,a.columns=d.columns,a.maps.x=[d.instantiateColumn(a.columns[2]),d.instantiateColumn(a.columns[0])],a.maps.y=[d.instantiateColumn(a.columns[3]),d.instantiateColumn(a.columns[4])],a.maps.color=[d.instantiateColumn(a.columns[1])],a.scaleTypes=[{type:"linear",name:"Linear"},{type:"log",name:"Logarithmic"}],a.showPromo=!0,a.saveAs=function(b,c){function d(){var b=document.createElement("canvas");return b.width=a.width,b.height=a.height,b}var e=$(c),f=(new XMLSerializer).serializeToString(e.get(0)),g=d(),h=new Image;h.width=a.width,h.height=a.height,h.src="data:image/svg+xml;charset=utf-8,"+f;var i,j=g.getContext("2d");try{j.drawImage(h,0,0),i=g.toDataURL("image/png")}catch(k){g=d(),canvg(g,f),i=g.toDataURL("image/png")}b.target.parentElement.href=i},a.lineInterpolationModes=["linear","linear-closed","step","step-before","step-after","basis","basis-open","basis-closed","bundle","cardinal","cardinal-open","cardinal-closed","monotone"],a.validateFn=function(b){var c;try{c=b.apply({},[a.chart.inputArg])}catch(d){return d.message}return a.chart.validateFn(c)},a.$watch(function(){var b,c=a.chart;try{b=c.fn?c.fn.apply({},[angular.copy(c.inputArg)]):c._dataCache}catch(d){return c._dataCache=void 0,void(c._dataCacheStr="")}angular.equals(b,c._dataCache)||(c._dataCache=b,c._dataCacheStr=JSON.stringify(b,null,"  "))}),a.chart=angular.copy(a.chartTypes[0]),a.chart.type=a.chartTypes[0],a.chart.inputArg=a.inputArg,a.chart.title="Chart title",a.chart.titleSize=24,a.chart.margin=30,a.chart.showLegend=!0,a.chart.showTitle=!0,a.chart.background="rgba(255,255,255,1)",a.chart.innerRadius=0,a.chart.vAxis={auto:!0,type:"linear",format:"n",ticks:10,bands:[]},a.chart.hAxis={auto:!0,type:"ordinal",format:"n",ticks:10,band:.1,band2:.1,bands:[]},a.chart.markers={show:!0,size:3},a.chart.lineInterpolation="linear",a.fonts=[{title:"Open Sans Light",family:"'Open Sans',sans-serif",weight:100},{title:"Open Sans",family:"'Open Sans',sans-serif",weight:400},{title:"Open Sans Bold",family:"'Open Sans',sans-serif",weight:800},{title:"Arial",family:"Arial,sans-serif",weight:400},{title:"Helvetica",family:"Helvetica,sans-serif",weight:400},{title:"Times New Roman",family:"'Times New Roman',Times,serif",weight:400},{title:"Courier New",family:"'Courier New',monospace",weight:400}],a.chart.font=a.fonts[0],a.import=function(a){{var b=function(b,c){b.data={url:"http://"},b.cancel=function(){c.dismiss("cancel")},b.ok=function(){f.get(b.data.url).success(function(d){c.dismiss("ok"),a.inputArg=d,a.url=b.data.url}).error(function(){b.error=!0})}};e.open({templateUrl:"import.html",controller:b,windowClass:"import"})}},a.refresh_import=function(a){f.get(a.url).success(function(b){a.inputArg=b}).error(function(){h.alert("Data refresh failed")})}}]),angular.module("pivotchart.directive",[]).factory("pivotUtil",["colors",function(){function a(a,b){var c=d3.scale[a.type]();return a.auto?c.domain(b).nice():c.domain([a.min,a.max])}return{getScale:a,twodChartDirective:function(b){var c=0;return{restrict:"E",templateUrl:b,replace:!0,scope:{chart:"=",data:"=",maps:"=",width:"=?",height:"=?"},require:"?^graphArea",link:function(b,d,e,f){f&&f.setGraphArea(b),b.margin=50,b.id=c++,b.$watch("[data, maps, chart, width, height]",function(){function c(a,c){return _(g).map(function(d,e){return d.variable?b.colordata[e][c]:d.get(a)}).join(" ")}var d=_(b.maps.x).reject("error").map("source").value(),e=_(b.maps.y).reject("error").map("source").value(),g=_(b.maps.color).reject("error").map("source").value(),h=b.chart.vAxis,i=b.chart.hAxis;b.innerWidth=b.width-b.margin,b.barWidth=b.innerWidth,b.xdata=_(d).map(function(a){return a.variable?_(e).map("name").unique().value():_(b.data).map(a.get).unique().value()}).value(),b.colordata=_(g).map(function(a){return a.variable?_(e).map("name").unique().value():_(b.data).map(a.get).unique().value()}).value(),b.legenddata=_(b.colordata).cartesianProduct().filter("length").map(function(a){return a.join(" ")}).value(),b.color=d3.scale.category20().domain(b.legenddata),f&&f.setLegendData(_(b.legenddata).map(function(a){return{text:a,color:b.color(a)}}).value()),b.x=_(d).map(function(a,c){var d=b.xdata[c],e=i.bands?i.bands[c]:.1;_.isUndefined(e)&&(e=.1);var f=d3.scale.ordinal().domain(d).rangeRoundBands([0,b.barWidth],e,0);return 0===f.rangeBand()&&f.rangeBands([0,b.barWidth],e,0),b.barWidth=f.rangeBand(),f}).value();var j=_(b.xdata).cartesianProduct().value();b.ydata=_(j).map(function(a){return _([b.data,e]).cartesianProduct().filter(function(b){return _(d).all(function(c,d){return c.variable?b[1].name==a[d]:c.get(b[0])==a[d]})}).value()}).value(),b.itemdata=_(b.ydata).map(function(a,b){var d=_(a).groupBy(function(a){return c(a[0],_.indexOf(e,a[1]))}).map(function(a,c){var d=_(a).map(function(a){return a[1].get(a[0])}).sum();return{reduced:a,reducedValue:d,colorKey:c,barIdx:b}}).reverse().value();return d}).flatten().value(),b.axisPadding=30,b.showAxis=function(a){var c=_.indexOf(b.x,a);return-1==c?!1:-1==_(g).findIndex({index:d[c].index})},b.visibleXAxes=_(b.x).filter(b.showAxis).value();var k,l;if("pivot-bars"==b.chart.type.type)l=_(b.ydata).map(function(a){return _.reduce(a,function(a,b){var c=b[1].get(b[0]);return a+Math.max(c,0)},0)}).max(),k=_(b.ydata).map(function(a){return _.reduce(a,function(a,b){var c=b[1].get(b[0]);return a+Math.min(c,0)},0)}).min();else{var m=_(b.ydata).flatten();k=m.min(),l=m.max()}b.y=a(h,[Math.min(0,k),Math.max(l,0)]).range([b.height-Math.max(0,b.visibleXAxes.length-1)*b.axisPadding,10]),h.min=b.y.domain()[0],h.max=b.y.domain()[1],b.xAxisPositions=function(a){var c=_.indexOf(b.x,a);return _(b.x).take(c).map(function(a){return a.range()}).cartesianProduct().map(_.sum).value()},b.barY=function(a){var c=a.reducedValue,d=_(b.itemdata).filter({barIdx:a.barIdx}).first(function(b){return b!==a}).map("reducedValue").filter(function(a){return a*c>=0}).sum();return b.y(Math.max(0,c)+d)},b.barX=function(a){return _(b.x).map(function(b,c){return b(d[c].variable?a.reduced[0][1].name:d[c].get(a.reduced[0][0]))}).sum()},b.barColor=function(a){return b.color(a.colorKey)},b.barHeight=function(a){var c=Math.min(Math.max(0,h.min),h.max);return Math.abs(b.y(a.reducedValue)-b.y(c))},b.line=d3.svg.line().x(function(a){return b.lineX(a.x)}).y(function(a){return b.y(a.y)}).interpolate(b.chart.lineInterpolation),b.lineX=function(a){return"ordinal"==b.chart.hAxis.type?b.x(a)+b.x.rangeBand()/2:b.x(a)}},!0)}}}}}]).directive("resizable",function(){return{restrict:"A",scope:{width:"=",height:"="},link:function(a,b){b.resizable({resize:function(b,c){a.$apply(function(){a.width=c.size.width,a.height=c.size.height})}})}}}).directive("dynamicDirective",["$parse","$compile",function(a,b){return{restrict:"EA",link:function(a,c,d){a.$watch(function(a){return a.$eval(d.dynamicDirective)},function(d){var e=angular.element("<"+d+"></"+d+">");angular.forEach(c.prop("attributes"),function(a){"dynamic-directive"!==a.name&&e.attr(a.name,a.textContent)}),c.html(e),b(c.contents())(a)})}}}]).directive("pivotColumnContainer",["input",function(a){return{restrict:"EA",templateUrl:"src/templates/columnContainer.html",replace:!0,scope:{isSource:"=pivotIsSource",restrict:"=pivotRestrict",name:"@pivotName"},require:"ngModel",link:function(b,c,d,e){b.$watch(function(){return e.$modelValue},function(){b.columns=e.$modelValue}),b.$watch("columns",function(){_(b.columns).each(function(a){if(b.restrict&&!_(b.restrict).contains(a.source.type)){var c=b.restrict.join(" and ");a.error=b.name+" only supports "+c+" columns."}else a.error=null})},!0),b.sortableSrc={connectWith:".data-list",helper:"clone",copy:!0,update:function(a,b){b.item.sortable.droptarget.not(a.target).length||b.item.sortable.cancel()},start:function(a,b){b.item.show()},receive:function(a,b){b.item.sortable.cancel(),b.item.sortable.deleted=!0}},b.sortableDst={connectWith:".data-list",receive:function(b,c){c.item.sortable.moved.source||(c.item.sortable.moved=a.instantiateColumn(c.item.sortable.moved))}}}}}]).directive("pivotColumn",function(){return{restrict:"EA",templateUrl:"src/templates/column.html",replace:!0,scope:{instance:"=pivotColumn"},link:function(a){a.$watch("instance",function(){a.column=a.instance.source||a.instance}),a.getText=function(a){return a.source?a.fn&&"number"===a.source.type?a.fn.name+" ( "+a.source.name+" )":a.source.name:a.name},a.columnLabel=function(a){return{number:{"class":"label-success",text:"Number"},text:{"class":"label-info",text:"Text"},date:{"class":"label-warning",text:"Date"}}[a]}}}}).directive("axisConfig",function(){return{restrict:"E",templateUrl:"src/templates/axisConfig.html",scope:{axis:"="},link:function(a){a.scaleTypes=[{type:"ordinal",name:"Ordinal"},{type:"linear",name:"Linear"},{type:"log",name:"Logarithmic"}]}}}).directive("d3Axis",function(){return{restrict:"A",scope:{scale:"=",orient:"@",tickFormat:"=",ticks:"=",tickSize:"="},link:function(a,b){var c=d3.svg.axis();a.$watch("[scale,orient,tickFormat,ticks,tickSize]",function(){if(angular.isUndefined(a.scale)||c.scale(a.scale),angular.isUndefined(a.orient)||c.orient(a.orient),!angular.isUndefined(a.ticks)){var d=parseInt(a.ticks);if(c.ticks(d),"undefined"!=typeof a.scale.rangeBands){var e=Math.ceil(a.scale.domain().length/d),f=a.scale.domain().filter(function(a,b){return b%e===0});c.tickValues(f)}}angular.isUndefined(a.tickSize)||c.tickSize(parseInt(a.tickSize)),c(b)},!0)}}}).directive("d3Legend",["colors",function(a){return{restrict:"EA",template:'<svg><g ng-repeat="d in reversedData track by $index" transform="translate(0,{{20 * $index}})"><rect width="15" height="15"   style="fill:{{d.color}}"></rect><text x="20" y="9" style="text-anchor:top; alignment-baseline:middle;">{{d.text}}</text></g></svg>',scope:{reverse:"="},require:"?^graphArea",replace:!0,link:function(b,c,d,e){b.color=a.get,b.$watch("[reverse,data]",function(){b.reversedData=_(b.data).clone(),b.reverse&&b.reversedData.reverse()},!0),b.$watch(function(){if(e){var a=(b.data,c[0].getBBox());e.setLegendWidth(a.width),b.data=e.getLegendData()}})}}}]).directive("graphArea",["colors",function(){return{restrict:"E",templateUrl:"src/templates/graphArea.html",replace:!0,scope:{data:"=",maps:"=",width:"=w",height:"=h",title:"=",showTitle:"=",titleSize:"=",font:"=",userMargin:"=margin",showLegend:"=",background:"=",reverseLegend:"="},transclude:!0,controller:["$scope","$element","$attrs","$transclude",function(a){var b=[];return{setLegendWidth:function(b){a.legendWidth=b},setLegendData:function(a){b=a},getLegendData:function(){return b},setGraphArea:function(b){this.graphScope=b,b.width=a.graphWidth,b.height=a.graphHeight}}}],link:function(a,b,c,d){var e=b.find(".title")[0];a.$watch("[data,maps]",function(){var b=_.map(a.maps.color,"source");a.legendData=b&&b.length?_(a.data).map(b[0].get).unique().value():[]},!0),a.$watch("[width,height,legendWidth,title,showTitle,titleSize,font,userMargin,showLegend]",function(){a.titleHeight=a.showTitle?1.3*e.getBBox().height:0,a.legendWidth=a.showLegend?a.legendWidth||0:0,a.margin={top:a.userMargin,right:a.userMargin,bottom:a.userMargin,left:a.userMargin},a.graphWidth=a.width-a.margin.left-a.margin.right-a.legendWidth,a.legendWidth&&(a.graphWidth-=a.margin.right/2),a.graphHeight=a.height-a.margin.top-a.margin.bottom-a.titleHeight,d.graphScope&&(d.graphScope.width=a.graphWidth,d.graphScope.height=a.graphHeight)},!0)}}}]).directive("pivotBars",["pivotUtil",function(a){return a.twodChartDirective("src/templates/bars.html")}]).directive("pivotLines",["pivotUtil",function(a){return a.twodChartDirective("src/templates/lines.html")}]).directive("pivotPie",["colors",function(a){return{restrict:"E",templateUrl:"src/templates/pie.html",replace:!0,scope:{chart:"=",data:"=",width:"=?",height:"=?"},require:"?^graphArea",link:function(b,c,d,e){e&&e.setGraphArea(b),b.$watch("[data, width, height, chart]",function(){var a=Math.min(b.width,b.height)/2,c=d3.svg.arc().outerRadius(a).innerRadius((b.chart.innerRadius||0)*a);b.yfirst=_.map(b.data.y,_.first);var d=d3.layout.pie()(b.yfirst);b.arc=function(a){return c(d[a])}},!0),b.color=a.get}}}]).directive("autofocus",["$timeout",function(a){return{restrict:"A",link:function(b,c){a(function(){a(function(){c[0].focus(),c[0].select()},!1)},!1)}}}]).directive("panel",function(){return{restrict:"E",template:'<div><div class="panel panel-default">  <div class="panel-heading">{{heading}}</div>  <div class="panel-body">    <div ng-transclude></div>  </div></div></div>',replace:!0,transclude:!0,scope:{heading:"@"},link:function(){}}}).directive("handsontable",["$rootScope",function(a){return{restrict:"A",require:"?ngModel",link:function(b,c,d,e){var f,g={cells:function(a,b){if(f&&f.getData()&&f.getData()[a]){var c=f.getData()[a][b],d=Number(c),e={};return e.renderer=""===c||Number.isNaN(d)?Handsontable.TextRenderer:Handsontable.NumericRenderer,e}},beforeChange:function(a){_(a).each(function(a){var b=a[0],c=a[1],d=(a[2],a[3],f.getCellMeta(b,c)),e=Number(a[3]);""===a[3]||Number.isNaN(e)?d.renderer=Handsontable.TextRenderer:(a[3]=e,d.renderer=Handsontable.NumericRenderer)})},afterChange:function(){b.$$phase||a.$apply()}};_.extend(g,b.$eval(d.handsontable)),$(c).handsontable(g),f=$(c).handsontable("getInstance"),e&&(e.$render=function(){e.$viewValue!=f.getData()&&f.loadData(e.$viewValue),f.render()})}}}]).directive("uiCodemirror",function(){return{restrict:"EA",require:"?ngModel",priority:1,link:function(a,b,c,d){function e(a){for(var b in a)a.hasOwnProperty(b)&&f.setOption(b,a[b])}if(angular.isUndefined(window.CodeMirror))throw new Error("ui-codemirror needs CodeMirror to work.");var f=new window.CodeMirror(function(a){b.append(a)});e(a.$eval(c.uiCodemirror)),angular.isDefined(a.$eval(c.uiCodemirror))&&a.$watch(c.uiCodemirror,e,!0),f.on("change",function(b){var c=b.getValue();d&&c!==d.$viewValue&&(d.$setViewValue(c),a.$apply())}),d&&(d.$formatters.unshift(function(a){if(angular.isUndefined(a)||null===a)return"";if(angular.isObject(a)||angular.isArray(a))throw new Error("ui-codemirror cannot use an object or an array as a model");return a}),d.$render=function(){var a=d.$viewValue||"";f.setValue(a)}),c.uiRefresh&&a.$watch(c.uiRefresh,function(a,b){a!==b&&f.refresh()})}}}).directive("editableFunction",function(){function a(a){if(!Array.isArray(a)||!Array.isArray(a[0]))throw new Error("transpose() can only be applied to an array of arrays");return _.range(a[0].length).map(function(b){return _.map(a,function(a){return a[b]})})}function b(a){return _.reduce(a,function(a,b){return a+b},0)}function c(a){return _.reduce(a,function(a,b){return a*b},1)}function d(a){return _.reduce(a,function(a,b){return _.flatten(_.map(a,function(a){return _.map(b,function(b){return a.concat([b])})}),!0)},[[]])}return _.mixin({transpose:a}),_.mixin({cartesianProduct:d}),_.mixin({sum:b},{chain:!1}),_.mixin({product:c},{chain:!1}),{restrict:"E",template:'<div><div js-function ui-codemirror="opts" ui-refresh="refresh" ng-model="scopemodel"></div><div class="alert alert-danger alert-bottom" ng-show="error">{{error}}</div></div>',scope:{scopemodel:"=ngModel",evalThis:"=",evalArgs:"=",validateFn:"=",refresh:"=uiRefresh"},replace:!0,require:["editableFunction","ngModel"],controller:["$scope",function(a){this.setSyntaxError=function(b){a.error=b},this.validate=function(b){if(a.validateFn)return void(a.error=a.validateFn(b));if(a.error=void 0,a.evalThis||a.evalArgs)try{b.apply(a.evalThis||{},a.evalArgs)}catch(c){return a.error=c.message,!1}return!0}}],link:function(a,b,c,d){function e(a){a.somethingSelected()?a.indentSelection("add"):a.replaceSelection(a.getOption("indentWithTabs")?"	":Array(a.getOption("indentUnit")+1).join(" "),"end","+input")}var f=d[0];a.$watch("evalArgs",function(){f.validate(a.scopemodel)}),a.$watch("evalThis",function(){f.validate(a.scopemodel)}),a.opts={tabSize:2,extraKeys:{Tab:e}}}}}).directive("jsFunction",function(){return{restrict:"A",require:["ngModel","?^editableFunction"],link:function(a,b,c,d){var e=d[0],f=d[1];e.$parsers.unshift(function(a){try{if(!a)return void 0;var b=new Function("return "+a)();return f&&f.validate(b),e.$setValidity("function",!0),b}catch(c){return e.$setValidity("function",!1),void(f&&f.setSyntaxError(c.message))}}),e.$formatters.unshift(function(a){return f&&f.validate(a),"object"==typeof a?JSON.stringify(a,null,"  "):"function"==typeof a?a.toString():""})}}}).directive("jsObject",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){var e=d;e.$parsers.unshift(function(a){try{return JSON.parse(a)}catch(b){return void e.$setValidity("json",!1)}}),e.$formatters.unshift(function(a){return JSON.stringify(a)})}}}).directive("contenteditable",["$rootScope",function(){return{require:"ngModel",link:function(a,b,c,d){b.bind("blur",function(){b.html()!=d.$viewValue&&a.$apply(function(){d.$setViewValue(b.html().replace(/<br>/g,""))})}),b.bind("keypress",function(a){return 13!=a.which}),b.bind("keyup",function(a){13==a.keyCode&&$(b).blur()}),d.$render=function(){b.html(d.$viewValue)}}}}]).directive("percentage",function(){return{restrict:"A",require:"ngModel",compile:function(){return function(a,b,c,d){d.$parsers.unshift(function(a){return parseFloat(a)/100}),d.$formatters.unshift(function(a){return 100*a+" %"})}}}}).directive("hcollapse",["$transition",function(a){return{link:function(b,c,d){function e(b){function d(){j===e&&(j=void 0)}var e=a(c,b);return j&&j.cancel(),j=e,e.then(d,d),e}function f(){k?(k=!1,g()):(c.removeClass("collapse").addClass("collapsing"),e({width:c[0].scrollWidth+"px"}).then(g))}function g(){c.removeClass("collapsing"),c.addClass("collapse in"),c.css({width:"auto"})}function h(){if(k)k=!1,i(),c.css({width:0});else{c.css({width:c[0].scrollWidth+"px"});{c[0].offsetHeight,c[0].offsetWidth}c.removeClass("collapse in").addClass("collapsing"),e({width:0}).then(i)}}function i(){c.removeClass("collapsing"),c.addClass("collapse")}var j,k=!0;b.$watch(d.hcollapse,function(a){a?h():f()})}}}]),angular.module("uidb.filter",["uidb.service"]).filter("fmt",function(){return function(a,b){return d3.format(b)(a)}}),angular.module("pivotchart",["pivotchart.controller","pivotchart.directive","ui.bootstrap","ui.sortable","colorpicker.module"]).config(["$compileProvider",function(a){a.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|data):/)}]),angular.module("pivotchart.service",[]).factory("input",function(){function a(a){return _(a).all(function(a){return"number"==typeof a||""===a||_.isNull(a)})?"number":_(a).all(function(a){return a instanceof Date})?"date":"text"}var b={columns:[],data:[]};return b.instantiateColumn=function(a){return{source:a,fn:{name:"SUM"}}},b.load=function(c){function d(a){return _(a).map(function(a){return _(a).all(function(a){return _.isNull(a)||""===a})}).foldr(function(a,b){return b&&!a[1]?[a[0]+1,!1]:[a[0],!0]},[0,!1])[0]}var e=d(c);b.data.length=0,_.merge(b.data,_(c).take(c.length-e).rest().value());var f=d(_(c).transpose()),g=b.columns[0]||{};_.merge(g,{name:"Variable name",type:"text",index:-1,variable:!0}),b.columns[0]=g,b.columns.length=c[0].length-f+1,_(b.columns).rest().forEach(function(d,e){var f=function(a){return a[e]},g=_(b.data).map(f),h=d||{};_.merge(h,{name:c[0][e],index:e,type:a(g),get:f,tooltip:g.unique().join(", ").substring(0,100)}),b.columns[e+1]=h})},b}).factory("colors",function(){var a=["steelBlue","rgb(255,153,0)","rgb(220,57,18)","rgb(70,132,238)","rgb(73,66,204)","rgb(0,128,0)"];return{get:function(b){if(b<a.length)return a[b];var c="rgb("+Math.round(255*Math.random())+","+Math.round(255*Math.random())+","+Math.round(255*Math.random())+")";return a.push(c),c}}}).factory("chartTypes",function(){function a(a){return"object"!=typeof a?"Return value must be an object":Array.isArray(a.series)?_.all(a.series,function(a){return"string"==typeof a})?Array.isArray(a.data)?_.all(a.data,function(a){return"object"==typeof a})?_.all(a.data,function(a){return"string"==typeof a.x})?_.all(a.data,function(a){return Array.isArray(a.y)})?"":'Objects in the "data" array must have "y" properties which are arrays':'Objects in the "data" array must have "x" properties of type string':'Elements in the "data" array must be objects':'Returned object must have a "data" property which is an array':'Elements in the "series" array must be strings':'Returned object must have a "series" property which is an array'}var b=[{name:"Bar chart",type:"pivot-bars",config:{legend:{display:!0,position:"right"}},fn:function(a){return a},validateFn:a,hasVAxis:!0,hasHAxis:!0}];return{get:function(){return b}}}).factory("charts",function(){var a=[];return{get:function(){return a},add:function(b){var c=angular.copy(b);a.push(c)},remove:function(b){var c=a.indexOf(b);a.splice(c,1)}}}),angular.module("pivotchart.tests",["pivotchart.directive","pivotchart.service"]).controller("TestsCtrl",["$scope",function(a){function b(a,b){return _(a).map(function(a){return _(b).map(function(b){return a(b)}).value()}).value()}function c(a){var b=_.cloneDeep(e);return _.forEach(arguments,function(a){_.merge(b,a)}),b.title=a,b}function d(a,c,d){return{series:a,x:c,y:b(d,c)}}var e={title:"Chart title",titleSize:12,margin:30,showLegend:!0,showTitle:!0,background:"rgba(255,255,255,1)",innerRadius:0,vAxis:{auto:!0,type:"linear",format:"n",ticks:10},hAxis:{auto:!0,type:"ordinal",format:"n",ticks:10,band:.1,band2:.1},lineInterpolation:"linear",barPlacement:"adjacent",markers:{size:3}},f={type:{type:"pivot-bars",hasVAxis:!0,hasHAxis:!0,hasMarkers:!1}},g={type:{type:"pivot-pie",hasVAxis:!1,hasHAxis:!1,hasMarkers:!1}},h={type:{type:"pivot-lines",hasVAxis:!0,hasHAxis:!0,hasMarkers:!0}},i={barPlacement:"stacked"},j={barPlacement:"overlapping"},k={hAxis:{type:"linear"}},l={hAxis:{type:"ordinal",format:".1f",ticks:5}},m={hAxis:{auto:!1,min:-1,max:1}},n={vAxis:{auto:!1,min:-.5,max:.5}},o=d(["sin","cos"],_.range(-5,5.1,1),[Math.sin,Math.cos]),p=d(["sin","cos"],_.range(-5,5.01,.1),[Math.sin,Math.cos]),q=d(["Series 1","Series 2"],[-10,10,20,100,300,310],[Math.sin,Math.cos]);a.data=[{title:"sin, cos at (-5:5)",data:o},{title:"sin, cos at (-5:.1:5)",data:p},{title:"sparse data",data:q}],a.charts=[c("Linear-X line",h,k),c("Clamp X-domain",h,k,m),c("Clamp Y-domain",h,k,n),c("Ordinal-X line",h,l),c("Ordinal-X bars",f,l),c("Ordinal-X stacked bars",f,i,l),c("Ordinal-X overlapping bars",f,j,l),c("Linear-X bars",f,k,{hAxis:{band:.5}}),c("Linear-X stacked bars",f,i,k),c("Pie",g),c("Donut",g,{innerRadius:.5}),c("Formatting",g,{showLegend:!1,font:{family:"Arial"},titleSize:30,background:"rgba(128,128,128,1)"})],a.height=300,a.width=400}]),angular.module("templates-main",["templates/axisConfig.html","templates/bars.html","templates/column.html","templates/columnContainer.html","templates/graphArea.html","templates/lines.html","templates/pie.html"]),angular.module("templates/axisConfig.html",[]).run(["$templateCache",function(a){a.put("templates/axisConfig.html",'<div>\n  <!--<div class="form-group">\n    <label>\n      Scale\n      <select ng-model="axis.type" class="form-control"\n        ng-options="type.type as type.name for type in scaleTypes">\n      </select>\n    </label>\n  </div>-->\n  <div class="form-group" ng-show="axis.type == \'ordinal\'">\n    <label>\n      Category spacing\n      <input type="text" percentage ng-model="axis.band"\n        class="form-control">\n    </label>\n  </div>\n  <div class="form-group" ng-show="axis.type == \'ordinal\'">\n    <label>\n      Cluster spacing\n      <input type="text" percentage ng-model="axis.band2"\n        class="form-control">\n    </label>\n  </div>\n  <div class="radio" ng-show="axis.type != \'ordinal\'">\n    <label>\n      <input type="radio" ng-model="axis.auto" ng-value="true"> Auto\n    </label>\n  </div>\n  <div class="radio" ng-show="axis.type != \'ordinal\'">\n    <label>\n      <input type="radio" ng-model="axis.auto" ng-value="false">\n      <div class="form-group form-inline axis-domain">\n        <label>\n          Min\n          <input type="number" ng-model="axis.min" class="form-control">\n        </label>\n        <label>\n          Max\n          <input type="number" ng-model="axis.max" class="form-control">\n        </label>\n      </div>\n    </label>\n  </div>\n  <div class="form-group">\n    <label>\n      Format\n      <input type="text" ng-model="axis.format" class="form-control">\n    </label>\n  </div>\n  <div class="form-group" ng-show="axis.type == \'linear\'">\n    <label>\n      Ticks\n      <input type="number" ng-model="axis.ticks" class="form-control">\n    </label>\n  </div>\n</div>\n')}]),angular.module("templates/bars.html",[]).run(["$templateCache",function(a){a.put("templates/bars.html",'<svg xmlns="http://www.w3.org/2000/svg">\n  <style>\n    .x.axis .domain { display: none; }\n  </style>\n  <defs>\n  <clipPath ng-attr-id="drawArea{{id}}">\n      <rect x="0" ng-attr-y="{{y.range()[1]}}"\n        ng-attr-width="{{innerWidth}}"\n        ng-attr-height="{{y.range()[0]-y.range()[1]}}" />\n    </clipPath>\n  </defs>\n  <g transform="translate({{margin}},0)">\n    <g ng-repeat="xx in visibleXAxes track by $index"\n      ng-attr-transform="translate(0,{{height - axisPadding * $index}})">\n      <g d3-axis class="x axis" ticks="chart.hAxis.ticks"\n        tick-format="chart.hAxis.format" ng-repeat="d in xAxisPositions(xx) track by $index"\n      ng-attr-transform="translate({{d}},0)" orient="bottom" scale="xx" tick-size="0">\n      </g>\n    </g>\n    <!-- Draw one zero line in case negative values exist -->\n    <line ng-attr-x1="{{width-margin}}" ng-attr-y1="{{y(0)}}" ng-attr-y2="{{y(0)}}"\n      style="stroke: #333;">\n    </line>\n    <g d3-axis class="y axis"\n      orient="left" ticks="chart.vAxis.ticks" tick-format="chart.vAxis.format" scale="y">\n    </g>\n    <g ng-repeat="d in itemdata track by $index">\n      <rect\n        ng-attr-width="{{barWidth}}"\n        ng-attr-x="{{barX(d)}}"\n        ng-attr-y="{{barY(d)}}"\n        ng-attr-height="{{barHeight(d)}}"\n        ng-attr-clip-path="url(#drawArea{{id}})"\n        style="fill: {{barColor(d)}};">\n        <!-- $index = seriesIdx, $parent.$index = categoryIdx -->\n      </rect>\n    </g>\n  </g>\n</svg>\n')}]),angular.module("templates/column.html",[]).run(["$templateCache",function(a){a.put("templates/column.html",'<li class="list-group-item data-column" title="{{column.tooltip}}">\n  <span class="label {{columnLabel(column.type).class}}">\n    {{columnLabel(column.type).text}}\n  </span>\n  <span ng-class="{variable: column.variable}">{{getText(instance)}}</span>\n  <span class="glyphicon glyphicon-exclamation-sign error"\n    ng-show="instance.error" title="{{instance.error}}"></span>\n</li>\n\n')}]),angular.module("templates/columnContainer.html",[]).run(["$templateCache",function(a){a.put("templates/columnContainer.html",'<ul class="list-group data-list" ng-class="{\'data-src-list\': isSource}"\n    ui-sortable="isSource ? sortableSrc : sortableDst">\n  <li pivot-column="col"\n      ng-repeat="col in columns track by $index"></li>\n</ul>\n\n')}]),angular.module("templates/graphArea.html",[]).run(["$templateCache",function(a){a.put("templates/graphArea.html",'<svg xmlns="http://www.w3.org/2000/svg"\n  ng-attr-width="{{width}}"\n  ng-attr-height="{{height}}"\n  ng-attr-style="font-family:{{font.family}}; font-weight:{{font.weight}}; background:{{background}}">\n  <style>\n    .axis path,\n    .axis line {\n      fill: none;\n      stroke: #333;\n    }\n    text { font-size: 11pt; }\n    .x.axis text { alignment-baseline: middle; }\n    .title { text-anchor: middle; }\n    .title text { alignment-baseline: hanging; }\n  </style>\n  <g>\n    <g transform="translate({{width/2}},{{margin.top}})"\n      ng-show="showTitle" class="title">\n      <text style="font-size: {{titleSize}}pt;">{{title}}</text>\n    </g>\n    <g transform="translate({{margin.left}},{{margin.top+titleHeight}})" ng-transclude>\n    </g>\n  </g>\n  <g transform="translate({{width - legendWidth - margin.right}},{{margin.top + titleHeight}})" ng-show="showLegend">\n    <d3-legend reverse="reverseLegend"></d3-legend>\n  </g>\n</svg>\n')}]),angular.module("templates/lines.html",[]).run(["$templateCache",function(a){a.put("templates/lines.html",'<svg xmlns="http://www.w3.org/2000/svg">\n  <defs>\n    <clipPath ng-attr-id="drawArea{{id}}">\n      <rect x="0" ng-attr-y="{{y.range()[1]}}"\n        ng-attr-width="{{innerWidth}}"\n        ng-attr-height="{{y.range()[0]-y.range()[1]}}" />\n    </clipPath>\n    <clipPath ng-attr-id="markersDrawArea{{id}}">\n      <rect\n        ng-attr-x="{{-chart.markers.size-1}}"\n        ng-attr-y="{{y.range()[1]-chart.markers.size-1}}"\n        ng-attr-width="{{innerWidth+2*(chart.markers.size+1)}}"\n        ng-attr-height="{{y.range()[0]-y.range()[1]+2*(chart.markers.size+1)}}" />\n    </clipPath>\n  </defs>\n  <g transform="translate({{margin}},0)">\n    <g d3-axis class="x axis"\n      ticks="chart.hAxis.ticks"\n      tick-format="chart.hAxis.format"\n      ng-attr-transform="translate(0,{{height}})" orient="bottom" scale="x" tick-size="0">\n    </g>\n    <!-- Draw one zero line in case negative values exist -->\n    <line ng-attr-x1="{{width-margin}}" ng-attr-y1="{{y(0)}}" ng-attr-y2="{{y(0)}}"\n      style="stroke: #333;">\n    </line>\n    <g d3-axis class="y axis"\n      orient="left" ticks="chart.vAxis.ticks" tick-format="chart.vAxis.format" scale="y">\n    </g>\n\n    <path ng-repeat="d in dataBySeries track by $index"\n      ng-attr-stroke="{{color($index)}}"\n      fill="none"\n      ng-attr-clip-path="url(#drawArea{{id}})"\n      ng-attr-d="{{line(d)}}">\n    </path>\n    <g ng-repeat="pts in dataBySeries track by $index">\n      <circle ng-attr-cx="{{lineX(d.x)}}" ng-attr-cy="{{y(d.y)}}"\n        fill="white"\n        ng-attr-r="{{chart.markers.size}}"\n        ng-attr-stroke="{{color($parent.$index)}}"\n        ng-attr-clip-path="url(#markersDrawArea{{id}})"\n        ng-repeat="d in pts">\n      </circle>\n    </g>\n  </g>\n</svg>\n')}]),angular.module("templates/pie.html",[]).run(["$templateCache",function(a){a.put("templates/pie.html",'<svg xmlns="http://www.w3.org/2000/svg">\n  <g transform="translate({{width/2}},{{height/2}})">\n    <g ng-repeat="group in yfirst">\n      <path ng-attr-d="{{arc($index)}}"\n        style="fill: {{color($index)}};">\n      </path>\n    </g>\n  </g>\n</svg>\n')}]);